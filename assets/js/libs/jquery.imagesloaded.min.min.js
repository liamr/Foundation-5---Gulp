!function(e){"use strict";function t(e,t){for(var i in t)e[i]=t[i];return e}function i(e){return"[object Array]"===a.call(e)}function n(e){var t=[];if(i(e))t=e;else if("number"==typeof e.length)for(var n=0,o=e.length;o>n;n++)t.push(e[n]);else t.push(e);return t}function o(e,i){function o(e,i,s){if(!(this instanceof o))return new o(e,i);"string"==typeof e&&(e=document.querySelectorAll(e)),this.elements=n(e),this.options=t({},this.options),"function"==typeof i?s=i:t(this.options,i),s&&this.on("always",s),this.getImages(),r&&(this.jqDeferred=new r.Deferred);var h=this;setTimeout(function(){h.check()})}function a(e){this.img=e}o.prototype=new e,o.prototype.options={},o.prototype.getImages=function(){this.images=[];for(var e=0,t=this.elements.length;t>e;e++){var i=this.elements[e];"IMG"===i.nodeName&&this.addImage(i);for(var n=i.querySelectorAll("img"),o=0,r=n.length;r>o;o++){var s=n[o];this.addImage(s)}}},o.prototype.addImage=function(e){var t=new a(e);this.images.push(t)},o.prototype.check=function(){function e(e,o){return t.options.debug&&h&&s.log("confirm",e,o),t.progress(e),i++,i===n&&t.complete(),!0}var t=this,i=0,n=this.images.length;if(this.hasAnyBroken=!1,!n)return void this.complete();for(var o=0;n>o;o++){var r=this.images[o];r.on("confirm",e),r.check()}},o.prototype.progress=function(e){this.hasAnyBroken=this.hasAnyBroken||!e.isLoaded;var t=this;setTimeout(function(){t.emit("progress",t,e),t.jqDeferred&&t.jqDeferred.notify(t,e)})},o.prototype.complete=function(){var e=this.hasAnyBroken?"fail":"done";this.isComplete=!0;var t=this;setTimeout(function(){if(t.emit(e,t),t.emit("always",t),t.jqDeferred){var i=t.hasAnyBroken?"reject":"resolve";t.jqDeferred[i](t)}})},r&&(r.fn.imagesLoaded=function(e,t){var i=new o(this,e,t);return i.jqDeferred.promise(r(this))});var f={};return a.prototype=new e,a.prototype.check=function(){var e=f[this.img.src];if(e)return void this.useCached(e);if(f[this.img.src]=this,this.img.complete&&void 0!==this.img.naturalWidth)return void this.confirm(0!==this.img.naturalWidth,"naturalWidth");var t=this.proxyImage=new Image;i.bind(t,"load",this),i.bind(t,"error",this),t.src=this.img.src},a.prototype.useCached=function(e){if(e.isConfirmed)this.confirm(e.isLoaded,"cached was confirmed");else{var t=this;e.on("confirm",function(e){return t.confirm(e.isLoaded,"cache emitted confirmed"),!0})}},a.prototype.confirm=function(e,t){this.isConfirmed=!0,this.isLoaded=e,this.emit("confirm",this,t)},a.prototype.handleEvent=function(e){var t="on"+e.type;this[t]&&this[t](e)},a.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindProxyEvents()},a.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindProxyEvents()},a.prototype.unbindProxyEvents=function(){i.unbind(this.proxyImage,"load",this),i.unbind(this.proxyImage,"error",this)},o}var r=e.jQuery,s=e.console,h="undefined"!=typeof s,a=Object.prototype.toString;"function"==typeof define&&define.amd?define(["libs/EventEmitter","libs/eventie"],o):e.imagesLoaded=o(e.EventEmitter,e.eventie)}(window);